replicaCount: 1

webapp:
  name: cirrustest
  group: cirrustest
  imagePullPolicy: Always
  path: /
  tls:
    fqdn: cirrustest.k8s.ucar.edu
    secretName: incommon-cert-cirrustest
  volume1:
    name: campaign
    server: gladedm1.ucar.edu
    path: /gpfs/csfs1
    readOnly: true
  volume2:
    name: output
    mountPath: /output
    size: 160Gi
    securityContext:
      runAsGroup: 1000
  volume3:
    name: checkpoint
    mountPath: /checkpoint
    size: 100Gi
    securityContext:
      runAsGroup: 1000
  extraVolumes:
    name: dshm
    emptyDir:
      medium: Memory
      sizeLimit: 128Gi
  container: 
    image: docker.io/sgpearse/cirrustest:1.3.13
    port: 8080
    requests: 
      memory: 128Gi
      cpu: 2
    limits: 
      memory: 128Gi
      cpu: 8

jobs:
  debug:
    enabled: true
    name: cirrustest-debug
    command: ["/bin/bash", "-c"]
    args: |
      #conda activate credit
      pwd
      ls
      cd /workspace/CIRRUS-MILES-CREDIT
      git pull
      git branch
      chmod 777 ./credit.sh
      ./credit.sh
      #./CIRRUS-MILES-CREDIT/credit.sh
      #git clone https://github.com/NCAR/CIRRUS-MILES-CREDIT.git
      #chmod 777 ./CIRRUS-MILES-CREDIT/credit.sh
      #./CIRRUS-MILES-CREDIT/credit.sh

cronjobs:
  credit:
    enabled: false
    name: cirrustest-cron
    #schedule: "0 0,6,12,18 * * *"
    schedule: "0 * * * *"
    timeZone: "America/Denver"
    command: ["/bin/bash", "-c"]
    args: |
      conda activate credit
      git clone https://github.com/NCAR/CIRRUS-MILES-CREDIT.git
      chmod 777 ./CIRRUS-MILES-CREDIT/credit.sh
      ./CIRRUS-MILES-CREDIT/credit.sh
